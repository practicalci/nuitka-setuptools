image: quay.io/pypa/manylinux1_x86_64

before_script:
  - export PATH=/opt/python/cp35-cp35m/bin:$PATH
  - pip install -U pip setuptools wheel twine
  - pip install .

stages:
  - test
  - deploy

test:
  stage: test
  script:
  - cd tests
  - python setup.py bdist_wheel
  - tar xvf dist/*.tgz

deploy:
  stage: deploy
  script:
  - python setup.py sdist
  - python setup.py bdist_wheel
  - twine upload -u $PYPI_USER -p $PYPI_PASS dist/*
  only:
  - tags